# Family Tree Schemas

Collaborator:
  type: object
  properties:
    id:
      type: string
      format: uuid
      description: Reference to a User ID from the auth service.
    name:
      type: string
      description: Email or display name of the user.
    role:
      $ref: "./GenealogyCommon.yaml#/CollaboratorRole"
    added_at:
      type: string
      format: date-time
      description: Timestamp when the collaborator was added.
    accepted_at:
      type: string
      format: date-time
      nullable: true
      description: Timestamp when the collaboration invitation was accepted.
  required:
    - id
    - name

FamilyTreeSettings:
  type: object
  properties:
    allow_collaboration:
      type: boolean
      default: true
    show_living_persons:
      type: boolean
      default: true
      description: Controls visibility of living persons to non-collaborators or based on privacy settings.
    default_person_privacy:
      $ref: "./GenealogyCommon.yaml#/PersonPrivacyOptions"
      default: family_tree_only
    theme:
      type: string
      maxLength: 50
      default: "modern"
      description: Visual theme for the family tree.

FamilyTreeStatistics:
  type: object
  properties:
    total_persons:
      type: integer
      format: int32
      default: 0
    total_generations:
      type: integer
      format: int32
      default: 0
    completeness_score:
      type: number
      format: float
      minimum: 0
      maximum: 100
      default: 0.0
      description: A score indicating the completeness of the tree data.

# Base FamilyTree structure (reflects DBModelMixin + FamilyTree fields from models_main.py)
FamilyTreeBase:
  type: object
  properties:
    name:
      type: string
      minLength: 1
      maxLength: 100
      description: Name of the family tree.
    description:
      type: string
      maxLength: 500
      nullable: true
      description: Optional description for the tree.
    owner_id:
      type: string
      format: uuid
      description: User ID of the creator/owner of the tree.
      readOnly: true # Usually set by the system based on authenticated user
    root_person_id:
      type: string
      format: uuid
      nullable: true
      description: Optional ID of the main person (root) of this family tree.
    members:
      type: array
      items:
        $ref: "#/Collaborator"
      default: []
      description: List of users who are members/collaborators of this tree. Each member has an id and name.
    privacy:
      $ref: "./GenealogyCommon.yaml#/PrivacySetting"
      default: PRIVATE
    settings:
      $ref: "#/FamilyTreeSettings"
    statistics:
      $ref: "#/FamilyTreeStatistics"
    last_gedcom_import:
      type: string
      format: date-time
      nullable: true
      readOnly: true
    last_gedcom_export:
      type: string
      format: date-time
      nullable: true
      readOnly: true
  required:
    - name
    - owner_id

# Schema for creating a FamilyTree
FamilyTreeCreate:
  type: object
  properties:
    name:
      type: string
      minLength: 1
      maxLength: 100
    description:
      type: string
      maxLength: 500
      nullable: true
    privacy:
      $ref: "./GenealogyCommon.yaml#/PrivacySetting"
      default: PRIVATE
    settings: # Allow partial settings on create or full default
      $ref: "#/FamilyTreeSettings"
      nullable: true
    root_person_id: # Allow setting root person on create
      type: string
      format: uuid
      nullable: true
    members:
      type: array
      items:
        $ref: "#/Collaborator"
      default: []
      description: List of users who are members/collaborators of this tree. Each member has an id and name.
  required:
    - name

# Schema for updating a FamilyTree
FamilyTreeUpdate:
  type: object
  properties:
    name:
      type: string
      minLength: 1
      maxLength: 100
      nullable: true
    description:
      type: string
      maxLength: 500
      nullable: true
    privacy:
      $ref: "./GenealogyCommon.yaml#/PrivacySetting"
      nullable: true
    settings:
      $ref: "#/FamilyTreeSettings" # Allow full or partial update of settings object
      nullable: true
    root_person_id:
      type: string
      format: uuid
      nullable: true
    members:
      type: array
      items:
        $ref: "#/Collaborator"
      default: []
      description: List of users who are members/collaborators of this tree. Each member has an id and name.
  minProperties: 1 # Ensure at least one field is provided for update

# Schema for reading/returning a FamilyTree
FamilyTreeRead:
  allOf:
    - $ref: "./GenealogyCommon.yaml#/DBModelMixinEffect" # id, created_at, updated_at
    - $ref: "#/FamilyTreeBase" # All other fields

# Schema for a list of Family Trees with pagination
FamilyTreeListResponse: # Corresponds to FamilyTreeList in schemas/family_tree.py
  type: object
  properties:
    items:
      type: array
      items:
        $ref: "#/FamilyTreeRead"
    total:
      type: integer
      description: Total number of family trees matching the query (can be -1 if not calculated).
  required:
    - items
    - total

# Summary view of a FamilyTree (if needed for brief listings)
FamilyTreeSummary:
  type: object
  properties:
    id:
      type: string
      format: uuid
    name:
      type: string
    privacy:
      $ref: "./GenealogyCommon.yaml#/PrivacySetting"
    updated_at:
      type: string
      format: date-time
  required:
    - id
    - name
    - privacy
    - updated_at
