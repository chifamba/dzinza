# Person History Schemas

# Base PersonHistory structure
PersonHistoryBase:
  type: object
  properties:
    person_id:
      type: string
      format: uuid
      description: ID of the Person record this history entry pertains to.
    version:
      type: integer
      format: int32
      minimum: 1
      description: Version number of this history entry for the person.
    data_snapshot:
      type: object
      additionalProperties: true # Allows any structure, representing the Person document
      description: A snapshot of the Person document's data at this version.
      example:
        primary_name: { given_name: "John", surname: "Doe" }
        birth_date_string: "1980-01-15"
        # ... other person fields ...
    changed_by_user_id:
      type: string
      # format: uuid # If user IDs are UUIDs
      description: User ID of the person or system process that made the change.
    change_type:
      $ref: './GenealogyCommon.yaml#/PersonHistoryChangeType'
    change_description:
      type: string
      maxLength: 500
      nullable: true
      description: Optional summary or reason for the change.
  required:
    - person_id
    - version
    - data_snapshot
    - changed_by_user_id
    - change_type

# Schema for creating PersonHistory (typically internal use by services)
# PersonHistory entries are usually created automatically, not via a direct API endpoint.
# If there were an API to manually add a history note, it would be different.

# Schema for reading/returning a PersonHistory entry
PersonHistoryRead:
  allOf:
    - $ref: './GenealogyCommon.yaml#/DBModelMixinEffect' # id (of history record), created_at (timestamp of history record)
                                                         # updated_at is less relevant for immutable history
    - $ref: '#/PersonHistoryBase'
  properties:
    # Override created_at from DBModelMixinEffect to be more specific if needed
    timestamp: # Alias for created_at, more intuitive for history
      type: string
      format: date-time
      description: Timestamp of when this history record was created (i.e., when the change occurred).
      # This would effectively be the same as created_at from DBModelMixinEffect

# Schema for a list of PersonHistory entries
PersonHistoryListResponse:
  type: object
  properties:
    items:
      type: array
      items:
        $ref: '#/PersonHistoryRead'
    total:
      type: integer
  required:
    - items
    - total
