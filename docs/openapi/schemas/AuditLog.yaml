# Audit Log Schemas

# Enum for AuditLogAction
AuditLogAction:
  type: string
  enum:
    - USER_REGISTERED
    - LOGIN_SUCCESS
    - LOGIN_FAILED_USER_NOT_FOUND
    - LOGIN_FAILED_INVALID_PASSWORD
    - LOGIN_FAILED_ACCOUNT_LOCKED
    - LOGIN_FAILED_INVALID_MFA
    - LOGOUT
    - PASSWORD_RESET_REQUESTED
    - PASSWORD_RESET_COMPLETED
    - PASSWORD_CHANGED
    - EMAIL_VERIFICATION_REQUESTED
    - EMAIL_VERIFIED
    - MFA_ENABLED
    - MFA_DISABLED
    - MFA_CODE_VERIFIED
    # Add other generic actions like ITEM_CREATED, ITEM_UPDATED, ITEM_DELETED if used broadly
  description: Type of action performed that was logged.
  example: LOGIN_SUCCESS

# Base properties for an audit log entry
AuditLogBase:
  type: object
  required:
    - action
  properties:
    action:
      $ref: '#/AuditLogAction'
    ip_address:
      type: string
      format: ip # Can be ipv4 or ipv6
      nullable: true
      description: IP address from which the action originated.
    user_agent:
      type: string
      nullable: true
      description: User agent string of the client.
    details:
      type: string # Or object if details are structured JSON
      nullable: true
      description: Additional details about the logged action (e.g., JSON string).

# Schema for creating an audit log entry (internal use)
AuditLogCreate:
  allOf:
    - $ref: '#/AuditLogBase'
    - type: object
      properties:
        user_id:
          type: string
          format: uuid
          nullable: true
          description: ID of the user associated with the action. Null if system action or anonymous.

# Schema for audit log entry response
AuditLogResponse:
  allOf:
    - $ref: '#/AuditLogBase'
    - type: object
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the audit log entry.
        user_id:
          type: string
          format: uuid
          nullable: true
          description: ID of the user associated with the action.
        user_email: # Denormalized for easier display, if available
          type: string
          format: email
          nullable: true
          description: Email of the user associated with the action.
        timestamp:
          type: string
          format: date-time
          description: Timestamp of when the action occurred.
  example:
    id: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
    user_id: "d290f1ee-6c54-4b01-90e6-d701748f0851"
    user_email: "user@example.com"
    action: "LOGIN_SUCCESS"
    ip_address: "192.168.1.100"
    user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36"
    timestamp: "2023-10-26T10:30:00Z"
    details: "Login successful via web form."
