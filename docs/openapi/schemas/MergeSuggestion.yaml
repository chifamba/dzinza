# Merge Suggestion Schemas

# Base MergeSuggestion structure
MergeSuggestionBase:
  type: object
  properties:
    new_person_id: # Person who is potentially a duplicate of an existing person
      type: string
      format: uuid
      description: ID of the person record that triggered the suggestion (e.g., newly added).
    existing_person_id: # Person already in the system that new_person might be a duplicate of
      type: string
      format: uuid
      description: ID of the existing person record that is a potential match.
    confidence:
      type: number
      format: float
      minimum: 0.0
      maximum: 1.0
      description: Confidence score (0.0 to 1.0) indicating the likelihood of the match.
    status:
      $ref: './GenealogyCommon.yaml#/MergeSuggestionStatus'
      default: pending
    created_by_user_id: # If a user manually flagged this suggestion
      type: string
      # format: uuid # If user IDs are UUIDs
      nullable: true
      description: User ID of the person who manually created this suggestion, if applicable.
    created_by_system: # If generated by an automated process
      type: boolean
      default: false
      description: True if the suggestion was generated by an automated system.
    # notified_users: # List of user IDs who have been notified about this suggestion
    #   type: array
    #   items:
    #     type: string
    #     # format: uuid
    #   default: []
    # preview_tree: # JSON snapshot of relevant parts of the tree for previewing the merge
    #   type: object
    #   additionalProperties: true
    #   nullable: true
    #   description: A snapshot of data to help visualize the potential merge.
  required:
    - new_person_id
    - existing_person_id
    - confidence

# Schema for creating a MergeSuggestion (typically internal use)
MergeSuggestionCreate:
  allOf:
    - $ref: '#/MergeSuggestionBase'
    # No additional fields for create, system sets id/timestamps

# Schema for updating a MergeSuggestion (e.g., changing status)
MergeSuggestionUpdate:
  type: object
  properties:
    status:
      $ref: './GenealogyCommon.yaml#/MergeSuggestionStatus'
      nullable: true
    confidence: # Allow updating confidence if re-evaluated
      type: number
      format: float
      minimum: 0.0
      maximum: 1.0
      nullable: true
  minProperties: 1

# Schema for reading/returning a MergeSuggestion
MergeSuggestionRead:
  allOf:
    - $ref: './GenealogyCommon.yaml#/DBModelMixinEffect' # id, created_at, updated_at
    - $ref: '#/MergeSuggestionBase'

# Schema for a list of MergeSuggestions
MergeSuggestionListResponse:
  type: object
  properties:
    items:
      type: array
      items:
        $ref: '#/MergeSuggestionRead'
    total:
      type: integer
  required:
    - items
    - total
